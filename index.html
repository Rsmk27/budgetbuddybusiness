<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BudgetBuddy Business</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4299e1; /* Blue-400 */
            --primary-dark-color: #3182ce; /* Blue-500 */
            --text-color: #1a202c; /* Gray-900 */
            --text-color-dark: #f7fafc; /* Gray-100 */
            --bg-color: #edf2f7; /* Gray-200 */
            --bg-dark-color: #171923; /* Gray-900 (custom) */
            --card-bg-color: #ffffff;
            --card-bg-dark-color: #2d3748; /* Gray-800 */
            --border-color: #e2e8f0; /* Gray-300 */
            --border-dark-color: #4a5568; /* Gray-600 */
        }

        body.dark {
            --text-color: var(--text-color-dark);
            --bg-color: var(--bg-dark-color);
            --card-bg-color: var(--card-bg-dark-color);
            --border-color: var(--border-dark-color);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
            transition: background-color 0.2s, transform 0.2s;
        }

        .primary-btn:hover {
            background-color: var(--primary-dark-color);
            transform: translateY(-1px);
        }
        
        .success-btn {
            background-color: #48bb78; /* Green-500 */
            color: white;
            transition: background-color 0.2s, transform 0.2s;
        }
        
        .success-btn:hover {
            background-color: #38a169; /* Green-600 */
            transform: translateY(-1px);
        }

        .card {
            background-color: var(--card-bg-color);
            border-color: var(--border-color);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .section.active {
            display: block;
            opacity: 1;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .message-box {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
        }
        
        .modal {
            display: none;
            z-index: 100;
        }

        .modal.open {
            display: flex;
        }

        /* Custom Styles for table */
        th, td {
            white-space: nowrap;
        }
        
        .currency-input-container {
            position: relative;
        }
        
        .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        
        .currency-input {
            padding-left: 28px !important;
        }
    </style>
</head>
<body class="antialiased dark:bg-gray-900 dark:text-gray-100">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, deleteDoc, onSnapshot, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase debug log level
        setLogLevel('debug');

        // --- Firebase Globals (Provided by Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- DOM Elements ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const loadingIndicator = document.getElementById('loading-indicator');
        const mainContent = document.getElementById('main-content');
        
        const totalExpensesSpan = document.getElementById('total-expenses');
        const totalIncomeSpan = document.getElementById('total-income');
        const netProfitSpan = document.getElementById('net-profit');

        const transactionTabLinks = document.querySelectorAll('.transaction-tab-link');
        const transactionTabContent = document.querySelectorAll('.transaction-tab-content');
        const expenseForm = document.getElementById('expense-form');
        const invoiceForm = document.getElementById('invoice-form');
        const billForm = document.getElementById('bill-form');
        
        const expenseListTableBody = document.getElementById('expense-list-table-body');
        const invoiceListTableBody = document.getElementById('invoice-list-table-body');
        const billListTableBody = document.getElementById('bill-list-table-body');
        const plReportTableBody = document.getElementById('pl-report-table-body');
        
        const messageBox = document.getElementById('message-box');
        const darkModeToggleHeader = document.getElementById('dark-mode-toggle-header');
        const darkModeToggleSettings = document.getElementById('dark-mode-toggle-settings');
        const userIdDisplay = document.getElementById('user-id-display');
        const companyIdDisplay = document.getElementById('company-id-display');

        const deleteModal = document.getElementById('delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        let deleteCallback = null;

        // --- Global State ---
        let db;
        let auth;
        let userId;
        let expensesData = [];
        let invoicesData = [];
        let billsData = [];
        let unsubscribeListeners = [];
        let dataLoaded = { expenses: false, invoices: false, bills: false };

        // --- Utility Functions ---

        /**
         * Displays a temporary message box to the user.
         * @param {string} message - The message to display.
         * @param {string} type - The type of message ('success', 'error').
         */
        function showMessageBox(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box show p-4 rounded-lg shadow-xl text-center font-medium ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }
        
        /**
         * Formats a number as currency.
         * @param {number} amount - The amount to format.
         * @returns {string} - Formatted currency string.
         */
        function formatCurrency(amount) {
            return `₹${parseFloat(amount).toFixed(2)}`;
        }

        /**
         * Hides the loading spinner and shows the main content.
         */
        function hideLoading() {
            if (dataLoaded.expenses && dataLoaded.invoices && dataLoaded.bills) {
                loadingIndicator.style.display = 'none';
                mainContent.classList.remove('hidden');
                // Set the initial active section
                document.querySelector('.nav-link.active').click();
            }
        }

        /**
         * Shows the custom modal for delete confirmation.
         * @param {string} collectionName - The Firestore collection name.
         * @param {string} docId - The document ID to delete.
         */
        function showDeleteModal(collectionName, docId) {
            deleteModal.classList.add('open');
            deleteCallback = () => {
                deleteDocFromFirestore(collectionName, docId);
                deleteModal.classList.remove('open');
            };
        }

        /**
         * Deletes a document from a specified collection after confirmation.
         * @param {string} collectionName - The name of the Firestore collection.
         * @param {string} docId - The ID of the document to delete.
         */
        async function deleteDocFromFirestore(collectionName, docId) {
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/${collectionName}`, docId));
                showMessageBox(`${collectionName.slice(0, -1)} deleted successfully.`, 'success');
            } catch (e) {
                console.error(`Error deleting ${collectionName.slice(0, -1)}:`, e);
                showMessageBox(`Failed to delete ${collectionName.slice(0, -1)}.`, 'error');
            }
        }

        // --- Firebase and Firestore Functions ---

        /**
         * Initializes Firebase and sets up authentication.
         */
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Set up authentication state listener
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = `User ID: ${userId}`;
                        companyIdDisplay.textContent = `Company ID: ${userId}`;
                        startRealtimeListeners();
                    } else {
                        console.log("User not authenticated, signing in anonymously...");
                        await signInAnonymously(auth);
                    }
                });

                // Sign in with custom token if available
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                }
            } catch (e) {
                console.error("Error initializing Firebase:", e);
                showMessageBox("Error initializing application. Please check console.", 'error');
            }
        }

        /**
         * Starts real-time listeners for all financial data.
         */
        function startRealtimeListeners() {
            unsubscribeListeners.forEach(unsub => unsub());
            unsubscribeListeners = [];
            dataLoaded = { expenses: false, invoices: false, bills: false };

            const collections = ['expenses', 'invoices', 'bills'];
            collections.forEach(collectionName => {
                const q = collection(db, `artifacts/${appId}/users/${userId}/${collectionName}`);
                const unsub = onSnapshot(q, (snapshot) => {
                    if (collectionName === 'expenses') {
                        expensesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        renderExpenses(expensesData);
                        dataLoaded.expenses = true;
                    } else if (collectionName === 'invoices') {
                        invoicesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        renderInvoices(invoicesData);
                        dataLoaded.invoices = true;
                    } else if (collectionName === 'bills') {
                        billsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        renderBills(billsData);
                        dataLoaded.bills = true;
                    }
                    updateDashboardSummary();
                    renderPLReport();
                    hideLoading();
                }, (error) => {
                    console.error(`Error fetching ${collectionName}:`, error);
                    showMessageBox(`Error fetching ${collectionName}.`, 'error');
                });
                unsubscribeListeners.push(unsub);
            });
        }

        /**
         * Adds a new expense to Firestore.
         */
        async function addExpense(e) {
            e.preventDefault();
            const title = e.target.elements['expense-title'].value;
            const amount = parseFloat(e.target.elements['expense-amount'].value);
            const category = e.target.elements['expense-category'].value;
            const date = e.target.elements['expense-date'].value;

            if (!title || isNaN(amount) || amount <= 0 || !category || !date) {
                showMessageBox("Please fill all expense fields correctly.", 'error');
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/expenses`), {
                    title, amount, category, date, createdAt: serverTimestamp()
                });
                showMessageBox("Expense added successfully!", 'success');
                expenseForm.reset();
            } catch (e) {
                console.error("Error adding expense:", e);
                showMessageBox("Failed to add expense. Please try again.", 'error');
            }
        }

        /**
         * Adds a new invoice to Firestore.
         */
        async function addInvoice(e) {
            e.preventDefault();
            const title = e.target.elements['invoice-title'].value;
            const amount = parseFloat(e.target.elements['invoice-amount'].value);
            const client = e.target.elements['invoice-client'].value;
            const date = e.target.elements['invoice-date'].value;

            if (!title || isNaN(amount) || amount <= 0 || !client || !date) {
                showMessageBox("Please fill all invoice fields correctly.", 'error');
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/invoices`), {
                    title, amount, client, date, status: 'Unpaid', createdAt: serverTimestamp()
                });
                showMessageBox("Invoice created successfully!", 'success');
                invoiceForm.reset();
            } catch (e) {
                console.error("Error adding invoice:", e);
                showMessageBox("Failed to create invoice. Please try again.", 'error');
            }
        }

        /**
         * Adds a new bill to Firestore.
         */
        async function addBill(e) {
            e.preventDefault();
            const title = e.target.elements['bill-title'].value;
            const amount = parseFloat(e.target.elements['bill-amount'].value);
            const vendor = e.target.elements['bill-vendor'].value;
            const date = e.target.elements['bill-date'].value;

            if (!title || isNaN(amount) || amount <= 0 || !vendor || !date) {
                showMessageBox("Please fill all bill fields correctly.", 'error');
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/bills`), {
                    title, amount, vendor, date, status: 'Unpaid', createdAt: serverTimestamp()
                });
                showMessageBox("Bill created successfully!", 'success');
                billForm.reset();
            } catch (e) {
                console.error("Error adding bill:", e);
                showMessageBox("Failed to create bill. Please try again.", 'error');
            }
        }

        // --- Rendering Functions ---

        function renderExpenses(expenses) {
            expenseListTableBody.innerHTML = '';
            if (expenses.length === 0) {
                expenseListTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-400">No expenses recorded yet.</td></tr>`;
            } else {
                const sortedExpenses = expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
                sortedExpenses.forEach(exp => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 dark:border-gray-700';
                    row.innerHTML = `
                        <td class="px-6 py-4">${exp.title}</td>
                        <td class="px-6 py-4">${exp.category}</td>
                        <td class="px-6 py-4 font-semibold text-red-600 dark:text-red-400">${formatCurrency(exp.amount)}</td>
                        <td class="px-6 py-4">${exp.date}</td>
                        <td class="px-6 py-4 text-right">
                            <button class="text-red-500 hover:text-red-700 transition" onclick="showDeleteModal('expenses', '${exp.id}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    expenseListTableBody.appendChild(row);
                });
            }
        }
        
        function renderInvoices(invoices) {
            invoiceListTableBody.innerHTML = '';
            if (invoices.length === 0) {
                invoiceListTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-400">No invoices created yet.</td></tr>`;
            } else {
                invoices.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(inv => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 dark:border-gray-700';
                    row.innerHTML = `
                        <td class="px-6 py-4">${inv.title}</td>
                        <td class="px-6 py-4">${inv.client}</td>
                        <td class="px-6 py-4 font-semibold text-green-600 dark:text-green-400">${formatCurrency(inv.amount)}</td>
                        <td class="px-6 py-4">${inv.date}</td>
                        <td class="px-6 py-4 text-right">
                            <button class="text-red-500 hover:text-red-700 transition" onclick="showDeleteModal('invoices', '${inv.id}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    invoiceListTableBody.appendChild(row);
                });
            }
        }
        
        function renderBills(bills) {
            billListTableBody.innerHTML = '';
            if (bills.length === 0) {
                billListTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-400">No bills recorded yet.</td></tr>`;
            } else {
                bills.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(bill => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 dark:border-gray-700';
                    row.innerHTML = `
                        <td class="px-6 py-4">${bill.title}</td>
                        <td class="px-6 py-4">${bill.vendor}</td>
                        <td class="px-6 py-4 font-semibold text-red-600 dark:text-red-400">${formatCurrency(bill.amount)}</td>
                        <td class="px-6 py-4">${bill.date}</td>
                        <td class="px-6 py-4 text-right">
                            <button class="text-red-500 hover:text-red-700 transition" onclick="showDeleteModal('bills', '${bill.id}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    billListTableBody.appendChild(row);
                });
            }
        }

        function updateDashboardSummary() {
            const totalExpenses = expensesData.reduce((sum, exp) => sum + exp.amount, 0);
            const totalIncome = invoicesData.reduce((sum, inv) => sum + inv.amount, 0);
            const netProfit = totalIncome - totalExpenses;

            totalExpensesSpan.textContent = formatCurrency(totalExpenses);
            totalIncomeSpan.textContent = formatCurrency(totalIncome);
            netProfitSpan.textContent = formatCurrency(netProfit);
            netProfitSpan.classList.toggle('text-green-600', netProfit >= 0);
            netProfitSpan.classList.toggle('text-red-600', netProfit < 0);
        }

        function renderPLReport() {
            plReportTableBody.innerHTML = '';

            const income = invoicesData.reduce((sum, inv) => sum + inv.amount, 0);
            const expenses = expensesData.reduce((sum, exp) => sum + exp.amount, 0);
            const netProfit = income - expenses;

            const incomeRow = document.createElement('tr');
            incomeRow.className = 'border-b border-gray-200 dark:border-gray-700';
            incomeRow.innerHTML = `<td class="px-6 py-4 font-bold">Total Income</td><td class="px-6 py-4 font-bold text-green-600">${formatCurrency(income)}</td>`;
            plReportTableBody.appendChild(incomeRow);

            const expenseRow = document.createElement('tr');
            expenseRow.className = 'border-b border-gray-200 dark:border-gray-700';
            expenseRow.innerHTML = `<td class="px-6 py-4 font-bold">Total Expenses</td><td class="px-6 py-4 font-bold text-red-600">${formatCurrency(expenses)}</td>`;
            plReportTableBody.appendChild(expenseRow);

            const profitRow = document.createElement('tr');
            profitRow.className = 'font-extrabold text-lg';
            profitRow.innerHTML = `
                <td class="px-6 py-4">Net Profit / Loss</td>
                <td class="px-6 py-4 ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">${formatCurrency(netProfit)}</td>
            `;
            plReportTableBody.appendChild(profitRow);
        }

        // --- UI & Navigation ---

        function handleNavigation(event) {
            event.preventDefault();
            const targetSectionId = event.currentTarget.dataset.section;

            navLinks.forEach(link => link.classList.remove('text-blue-600', 'font-semibold', 'bg-blue-100', 'dark:text-blue-400', 'dark:bg-gray-700'));
            event.currentTarget.classList.add('text-blue-600', 'font-semibold', 'bg-blue-100', 'dark:text-blue-400', 'dark:bg-gray-700');

            sections.forEach(section => section.classList.remove('active'));
            document.getElementById(targetSectionId).classList.add('active');
        }

        function handleTransactionTabChange(event) {
            event.preventDefault();
            const targetTab = event.currentTarget.dataset.tab;

            transactionTabLinks.forEach(link => link.classList.remove('bg-gray-200', 'dark:bg-gray-700'));
            event.currentTarget.classList.add('bg-gray-200', 'dark:bg-gray-700');

            transactionTabContent.forEach(content => content.classList.add('hidden'));
            document.getElementById(targetTab).classList.remove('hidden');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDarkMode = document.body.classList.contains('dark');
            localStorage.setItem('darkMode', isDarkMode);
            darkModeToggleSettings.checked = isDarkMode;
            darkModeToggleHeader.querySelector('i').className = isDarkMode ? 'fas fa-sun text-lg' : 'fas fa-moon text-lg';
        }

        function loadDarkModePreference() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark');
                darkModeToggleHeader.querySelector('i').className = 'fas fa-sun text-lg';
            }
        }

        // --- Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            loadDarkModePreference();
            initializeFirebase();

            const today = new Date().toISOString().split('T')[0];
            const expenseDateInput = document.getElementById('expense-date');
            const invoiceDateInput = document.getElementById('invoice-date');
            const billDateInput = document.getElementById('bill-date');

            if (expenseDateInput) expenseDateInput.value = today;
            if (invoiceDateInput) invoiceDateInput.value = today;
            if (billDateInput) billDateInput.value = today;

            expenseForm.addEventListener('submit', addExpense);
            invoiceForm.addEventListener('submit', addInvoice);
            billForm.addEventListener('submit', addBill);
            darkModeToggleHeader.addEventListener('click', toggleDarkMode);
            darkModeToggleSettings.addEventListener('change', toggleDarkMode);
            navLinks.forEach(link => link.addEventListener('click', handleNavigation));
            transactionTabLinks.forEach(link => link.addEventListener('click', handleTransactionTabChange));
            confirmDeleteBtn.addEventListener('click', () => {
                if (deleteCallback) deleteCallback();
            });
            cancelDeleteBtn.addEventListener('click', () => deleteModal.classList.remove('open'));

            // Expose function to global scope
            window.showDeleteModal = showDeleteModal;
        });
    </script>

    <div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        <span class="text-3xl font-extrabold text-blue-600">BudgetBuddy</span>
                        <span class="text-lg font-medium text-gray-500 dark:text-gray-400 ml-2">Business</span>
                    </div>
                    <nav class="hidden sm:block">
                        <div class="flex items-baseline space-x-4">
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 text-blue-600 bg-blue-100 dark:text-blue-400 dark:bg-gray-700" data-section="dashboard">Dashboard</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:text-blue-600 hover:bg-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-700" data-section="transactions">Transactions</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:text-blue-600 hover:bg-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-700" data-section="invoices">Invoices</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:text-blue-600 hover:bg-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-700" data-section="bills">Bills</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:text-blue-600 hover:bg-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-700" data-section="reports">Reports</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:text-blue-600 hover:bg-gray-100 dark:hover:text-blue-400 dark:hover:bg-gray-700" data-section="settings">Settings</a>
                        </div>
                    </nav>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="dark-mode-toggle-header" class="p-2 rounded-full text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-200">
                        <i class="fas fa-moon text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Initial Loading Spinner -->
        <div id="loading-indicator" class="flex justify-center items-center h-screen">
            <div class="spinner"></div>
        </div>

        <!-- Main Content Wrapper -->
        <div id="main-content" class="hidden">
            <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section px-4 py-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Total Income Card -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-sm font-semibold text-gray-500 uppercase">Total Income</h3>
                            <p id="total-income" class="mt-1 text-3xl font-bold text-green-600">₹0.00</p>
                        </div>
                        <!-- Total Expenses Card -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-sm font-semibold text-gray-500 uppercase">Total Expenses</h3>
                            <p id="total-expenses" class="mt-1 text-3xl font-bold text-red-600">₹0.00</p>
                        </div>
                        <!-- Net Profit Card -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-sm font-semibold text-gray-500 uppercase">Net Profit / Loss</h3>
                            <p id="net-profit" class="mt-1 text-3xl font-bold text-gray-900 dark:text-gray-100">₹0.00</p>
                        </div>
                    </div>

                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 mb-6">
                        <h2 class="text-xl font-bold mb-4">Latest Expenses</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Title</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Category</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="relative px-6 py-3">
                                            <span class="sr-only">Delete</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="expense-list-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Expense data will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <!-- Transactions Section -->
                <section id="transactions" class="section px-4 py-6">
                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold mb-4">Add a Transaction</h2>
                        <div class="flex mb-4 border-b border-gray-200 dark:border-gray-700">
                            <button class="transaction-tab-link py-2 px-4 font-medium text-sm rounded-t-lg bg-gray-200 dark:bg-gray-700 transition" data-tab="expense-tab">Expense</button>
                            <button class="transaction-tab-link py-2 px-4 font-medium text-sm rounded-t-lg transition" data-tab="invoice-tab">Invoice</button>
                            <button class="transaction-tab-link py-2 px-4 font-medium text-sm rounded-t-lg transition" data-tab="bill-tab">Bill</button>
                        </div>
                        
                        <div id="expense-tab" class="transaction-tab-content">
                            <form id="expense-form" class="space-y-4">
                                <div>
                                    <label for="expense-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Title</label>
                                    <input type="text" id="expense-title" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="expense-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Amount</label>
                                    <div class="relative mt-1">
                                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 dark:text-gray-400">₹</span>
                                        <input type="number" id="expense-amount" step="0.01" required class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm pl-7 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    </div>
                                </div>
                                <div>
                                    <label for="expense-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                                    <select id="expense-category" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Select Category</option>
                                        <option value="Cost of Goods Sold">Cost of Goods Sold</option>
                                        <option value="Payroll">Payroll</option>
                                        <option value="Rent">Rent</option>
                                        <option value="Utilities">Utilities</option>
                                        <option value="Office Supplies">Office Supplies</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Travel">Travel</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="expense-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date</label>
                                    <input type="date" id="expense-date" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <button type="submit" class="w-full primary-btn py-2 px-4 rounded-md shadow-sm text-sm font-medium">
                                    <i class="fas fa-plus-circle mr-2"></i> Add Expense
                                </button>
                            </form>
                        </div>

                        <div id="invoice-tab" class="transaction-tab-content hidden">
                            <form id="invoice-form" class="space-y-4">
                                <div>
                                    <label for="invoice-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Invoice Title</label>
                                    <input type="text" id="invoice-title" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="invoice-client" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Client Name</label>
                                    <input type="text" id="invoice-client" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="invoice-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Amount</label>
                                    <div class="relative mt-1">
                                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 dark:text-gray-400">₹</span>
                                        <input type="number" id="invoice-amount" step="0.01" required class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm pl-7 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    </div>
                                </div>
                                <div>
                                    <label for="invoice-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Invoice Date</label>
                                    <input type="date" id="invoice-date" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <button type="submit" class="w-full success-btn py-2 px-4 rounded-md shadow-sm text-sm font-medium">
                                    <i class="fas fa-file-invoice-dollar mr-2"></i> Create Invoice
                                </button>
                            </form>
                        </div>

                        <div id="bill-tab" class="transaction-tab-content hidden">
                            <form id="bill-form" class="space-y-4">
                                <div>
                                    <label for="bill-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Title</label>
                                    <input type="text" id="bill-title" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="bill-vendor" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Vendor Name</label>
                                    <input type="text" id="bill-vendor" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="bill-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Amount</label>
                                    <div class="relative mt-1">
                                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 dark:text-gray-400">₹</span>
                                        <input type="number" id="bill-amount" step="0.01" required class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm pl-7 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    </div>
                                </div>
                                <div>
                                    <label for="bill-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Bill Date</label>
                                    <input type="date" id="bill-date" required class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <button type="submit" class="w-full primary-btn py-2 px-4 rounded-md shadow-sm text-sm font-medium">
                                    <i class="fas fa-receipt mr-2"></i> Add Bill
                                </button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Invoices Section -->
                <section id="invoices" class="section px-4 py-6">
                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold mb-4">Invoices (Accounts Receivable)</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Title</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Client</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="relative px-6 py-3">
                                            <span class="sr-only">Delete</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="invoice-list-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Invoice data will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <!-- Bills Section -->
                <section id="bills" class="section px-4 py-6">
                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold mb-4">Bills (Accounts Payable)</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Title</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Vendor</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="relative px-6 py-3">
                                            <span class="sr-only">Delete</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="bill-list-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Bill data will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports" class="section px-4 py-6">
                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold mb-4">Profit & Loss Report</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Metric</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="pl-report-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Report data will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="section px-4 py-6">
                    <div class="card p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold mb-4">Settings</h2>
                        <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-200 dark:border-gray-700">
                            <span class="font-medium">Dark Mode</span>
                            <label for="dark-mode-toggle-settings" class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle-settings" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div class="flex flex-col space-y-2 text-sm text-gray-500 dark:text-gray-400">
                            <span id="user-id-display">User ID: N/A</span>
                            <span id="company-id-display">Company ID: N/A</span>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    <div id="message-box" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50"></div>

    <!-- Custom Delete Modal -->
    <div id="delete-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center z-[1000]">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-96 max-w-lg">
            <h3 class="text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100">Confirm Deletion</h3>
            <p class="text-gray-700 dark:text-gray-300">Are you sure you want to delete this record? This action cannot be undone.</p>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-delete-btn" class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition">Cancel</button>
                <button id="confirm-delete-btn" class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition">Delete</button>
            </div>
        </div>
    </div>

</body>
</html>
